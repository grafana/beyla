name: dummy-entities
entities:
  - type: Service
    name: source
    scope:
      namespace: src_namespace
      env: asserts_env
      site: asserts_site
    definedBy:
      - query: |
          group by (asserts_env, asserts_site, src_namespace, src_name) (network_flow_bytes_total)
  - type: Service
    name: destination
    scope:
      namespace: dst_namespace
      env: asserts_env
      site: asserts_site
    definedBy:
      - query: |
          group by (asserts_env, asserts_site, dst_namespace, dst_name) (network_flow_bytes_total)
relations:
  - type: ROUTES
    startEntityType: Service
    endEntityType: Service
    definedBy: !<METRICS>
      pattern: |
        group by (asserts_env, asserts_site, src_namespace, src_name, dst_namespace, dst_name) (
            rate(network_flow_bytes_total[1m])
        )
      startEntityMatchers:
        name: src_name
        namespace: src_namespace
        env: asserts_env
        site: asserts_site
      endEntityMatchers:
        name: dst_name
        namespace: dst_namespace
        env: asserts_env
        site: asserts_site
