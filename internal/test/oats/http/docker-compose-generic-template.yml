version: "3.9"
services:
  grafana:
    image: grafana/grafana:10.4.19@sha256:a9043254ba16fb10945cc27333963dfd08eccbb43b51f1222d831cc564e3a1f4
    volumes:
      - "{{ .ConfigDir }}/grafana-datasources.yaml:/etc/grafana/provisioning/datasources/grafana-datasources.yaml"
    ports:
      - "{{ .GrafanaHTTPPort }}:3000"
  prometheus:
    image: prom/prometheus:v2.55.1@sha256:2659f4c2ebb718e7695cb9b25ffa7d6be64db013daba13e05c875451cf51b0d3
    command:
      - --web.enable-remote-write-receiver
      - --enable-feature=exemplar-storage
      - --enable-feature=native-histograms
      - --config.file=/etc/prometheus/prometheus.yml
    ports:
      - "{{ .PrometheusHTTPPort }}:9090"
  tempo:
    image: grafana/tempo:2.10.0@sha256:d7f4c72e0bad2b42b4e7263b0addaf3f5bbc105cec6b1917eba0aae3b9b70364
    volumes:
      - "{{ .ConfigDir }}/tempo-config.yaml:/config.yaml"
    command:
      - --config.file=/config.yaml
    ports:
      - 4317:4317
      - "{{ .TempoHTTPPort }}:3200"

  collector:
    image: otel/opentelemetry-collector-contrib:0.144.0@sha256:213886eb6407af91b87fa47551c3632be1a6419ff3a5114ef1e6fc364628496f
    volumes:
      - "{{ .ConfigDir }}/otelcol-config.yaml:/config.yaml"
    command:
      - --config=file:/config.yaml
    ports:
      - 4318:4318
